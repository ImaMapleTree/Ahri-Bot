<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=640">

    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}" media="screen">
    <link rel="stylesheet" href="{{ '/assets/css/mobile.css' | relative_url }}" media="handheld, only screen and (max-device-width:640px)">
    <link rel="stylesheet" href="{{ '/assets/css/non-screen.css' | relative_url }}" media="handheld, only screen and (max-device-width:640px)">
    <link rel="stylesheet" href="{{ '/assets/css/bar-style.css' | relative_url }}">


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://apis.google.com/js/client.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="{{ '/assets/js/modernizr.js' | relative_url }}"></script>
	<script src="{{ 'assets/js/ahri-bot.js' | relative_url }}", type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="{{ '/assets/js/headsmart.min.js' | relative_url }}"></script>
	<link rel="icon" href="{{ 'assets/images/AhriBotfavicon.png' | relative_url}}" type="image/x-icon" />
	<div class="hover_bkgr_fricc">
		<span class="helper">SID</span>
		<div>
			<div class="popupCloseButton">&times;</div>
			<div id="UH2">
				<h2 class="header-level-2">Upload Highlights!</h2>
			</div>
			<div id="drop_zone">
				<p>Drop Files Here<br>or</p>
				<input type="file" id="files" name="files[]" class="dead" accept="video/*" multiple />
				<label for="files"><p class="Bfiles">Browse Files</p></label>
			</div>
			<div id="UP" class="UPLB">
				<p id="UPLB" onclick="Upload()">Upload</p>
			</div>
			<output id="list"></output>
		</div>
	</div>
	
    <script type="text/javascript">
		// Client ID and API key from the Developer Console
		var CLIENT_ID = '470810586360-9g7v7qd3sus5dopivtbebcu447r4mf2u.apps.googleusercontent.com';
		var API_KEY = 'AIzaSyAev1MMhuznuu7gXeDiQhWW4qXcdXMVO7I';

		// Array of API discovery doc URLs for APIs used by the quickstart
		var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];

		// Authorization scopes required by the API; multiple scopes can be
		// included, separated by spaces.
		var SCOPES = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive';
		
		var access_token
		
		async function roughSizeOfObject(object) {

			var objectList = [];
			var stack = [ object ];
			var bytes = 0;

			while ( stack.length ) {
				var value = stack.pop();

				if ( typeof value === 'boolean' ) {
					bytes += 4;
				}
				else if ( typeof value === 'string' ) {
					bytes += value.length * 2;
				}
				else if ( typeof value === 'number' ) {
					bytes += 8;
				}
				else if
				(
					typeof value === 'object'
					&& objectList.indexOf( value ) === -1
				)
				{
					objectList.push( value );

					for( var i in value ) {
						stack.push( value[ i ] );
					}
				}
			}
			return bytes;
		}

		function get_access_token_using_saved_refresh_token() {
			// from the oauth playground
			const refresh_token = "1//04ZTvrysIObh5CgYIARAAGAQSNwF-L9IrI-UpCU1JLPItWLXDYBikOlJBXFv1HJdOx92S43uEjrlap1L3BwL_-3VF-hSP7vNEo1A";
			// from the API console
			const client_id = "470810586360-9g7v7qd3sus5dopivtbebcu447r4mf2u.apps.googleusercontent.com";
			// from the API console
			const client_secret = "ZvfgUW5PRUWdsW6weRjFV574";
			// from https://developers.google.com/identity/protocols/OAuth2WebServer#offline
			const refresh_url = "https://www.googleapis.com/oauth2/v4/token";

			const post_body = `grant_type=refresh_token&client_id=${encodeURIComponent(client_id)}&client_secret=${encodeURIComponent(client_secret)}&refresh_token=${encodeURIComponent(refresh_token)}`;

			let refresh_request = {
				body: post_body,
				method: "POST",
				headers: new Headers({
					'Content-Type': 'application/x-www-form-urlencoded'
				})
			}

			// post to the refresh endpoint, parse the json response and use the access token to call files.list
			fetch(refresh_url, refresh_request).then( response => {
					return(response.json());
				}).then( response_json =>  {
					console.log(response_json);
					access_token = response_json.access_token;
			});
		}
		
		async function UploadStart() {
			var Upload_button = document.getElementById("UPLB");
			Upload_button.innerHTML = "Uploading...";
			return;
		}
		
		function UploadFin() {
			var Upload_button2 = document.getElementById("UP");
			var Upload_button = document.getElementById("UPLB");
			var Upload_complete = document.getElementById("UH2");
			var FinTwice = document.getElementById("UPLFin");
			Upload_button.innerHTML = "Upload";
			Upload_button.setAttribute("style", "background-color: white;");
			output = [];
			outfiles = [];
			document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
		}
		
		async function Upload() {
			var url = window.location.href
			var Upload_button = document.getElementById("UP");
			var ECC = url.split("#")[1]
			var NEK = CookieCheck('ECC')
			var DCCD = DEC(NEK);
			await UploadStart();
			Upload_button.setAttribute("style", "background-color: #f0f0f0;");
			
			
			const this_url = "https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable";
			const proxyurl = "https://cors-anywhere.herokuapp.com/";
			var generateID = {"name": outfiles[0].name, "mimeType": outfiles[0].type, "description": "Uploaded by AhriBot", 'appProperties': {"id": NEK, "decid": DCCD}}
			var initbytes = await roughSizeOfObject(generateID)
			let drive_request = {
				method: "POST",
				headers: new Headers({
					'Authorization': "Bearer "+access_token,
					'Content-Length': initbytes,
					'Content-Type': 'application/json; charset=UTF-8',
					'X-Upload-Content-Type': outfiles[0].type,
					'X-Upload-Content-Length': outfiles[0].size,
				}),
				body: JSON.stringify(generateID)
			};
			let resumable_url = await Fetch(proxyurl + this_url, drive_request);
			
			//FILE_ID = future.id;
			//let drive_url = proxyurl + "https://www.googleapis.com/upload/drive/v3/files/" + FILE_ID + "?uploadType=resumable";
			var file = outfiles[0];
			var request_times = file.size / 256000
			var buffer = await file.arrayBuffer();
			console.log(request_times)
			let final_request = {
				method: "PUT",
				params: {
					"uploadType": "resumable"
				},
				headers: new Headers({
					'Host': 'www.googleapis.com',
					'Authorization': "Bearer "+access_token,
					'Content-Length': buffer.length,
					'Content-Type': outfiles[0].type,
				}),
				body: buffer
			};
			let new_future = await Fetch(resumable_url, final_request);
			UploadFin()
			
			
		}	
		async function Fetch(url, api_request){
			var st = performance.now();
			var Upload_button = document.getElementById("UPLB");
			var Upload_text = document.getElementById("UP");
			Upload_button.innerHTML = "Uploading...";
			console.log(outfiles[0]);
			let response = await fetch(url, api_request)
			try {
				let ARS = await response.json()
				return(ARS);
			} catch {
				console.log("Getting Headers")
				let headers = await response.headers;
				let ARS = await headers.get('location')
				return(ARS);
			} finally {
				var et = performance.now() - st;
				console.log("Got a response in " + et.toFixed(3) + "miliseconds");
			}
		}
		
		
		if (window.File && window.FileReader && window.FileList && window.Blob) {
		  // Great success! All the File APIs are supported.
		} else {
		  alert('The File APIs are not fully supported in this browser.');
		}
		
		var output = [];
		var outfiles = [];
		function handleFileSelect(evt) {
			evt.stopPropagation();
			evt.preventDefault();

			var files = evt.dataTransfer.files; // FileList object.
			// files is a FileList of File objects. List some properties.
			
			for (var i = 0, f; f = files[i]; i++) {
				output.push('<li><strong>', escape(f.name), '</strong> - ',
						  f.size, ' bytes, last modified: ',
						  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
						  '</li>');
				outfiles.push(f)
			}
			console.log(f.size)
			//10,517,814
			
			
			document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
		  }

		function handleDragOver(evt) {
			evt.stopPropagation();
			evt.preventDefault();
			evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
		}

		  // Setup the dnd listeners.
		var dropZone = document.getElementById('drop_zone');
		dropZone.addEventListener('dragover', handleDragOver, false);
		dropZone.addEventListener('drop', handleFileSelect, false);
		  
		function handleFileSelect2(evt) {
			var files = evt.target.files; // FileList object

			for (var i = 0, f; f = files[i]; i++) {
				output.push('<li><strong>', escape(f.name), '</strong> - ',
					f.size, ' bytes, last modified: ',
					f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
					'</li>');
				outfiles.push(f)
			}
			document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
		}

		document.getElementById('files').addEventListener('change', handleFileSelect2, false);
		  
		get_access_token_using_saved_refresh_token();
	</script>
	<script>
		$(document).ready(function () {
		$.getJSON("https://api.jsonbin.io/b/5e1ea24db236b871b3621d94/latest", function (json) {
			var bad_solution = document.getElementById("proudly-used-by-loading-servers");
			var server_container = bad_solution.childNodes[1];
			server_container.setAttribute("style", "color: #ff9b0f;");
			server_container.innerHTML = json.servers;
		})
	});
	
       $(document).ready(function () {
         $('#main_content').headsmart()
       });
	   $(window).load(function () {
		$(".trigger_popup_fricc").click(function(){
		   $('.hover_bkgr_fricc').show();
		});
		$('.popupCloseButton').click(function(){
			$('.hover_bkgr_fricc').hide();
		});
		});
		$(document).ready(function (){
			var url = window.location.href
			var ECC = url.split("#")[1]
			if (ECC != undefined) {
				$('.hover_bkgr_fricc').show();
				var EK = CookieCheck('ECC')
				}
			else {
				var EK = CookieCheck('ECC')
			}
			if (EK == undefined) {
				var Expiration = new Date();
				Expiration.setTime(Expiration.getTime() + 120000);
				var expires = "expires=" + Expiration.toUTCString();
				document.cookie = "ECC=" + ECC + ";" + expires + "path=/;"
			}
			var NEK = CookieCheck('ECC')
			//var DL, ID, K = DEC(NEK)
			var DCCD = DEC(NEK)
		});
    </script>
	<div id="container">
		<div class="scale">
			<div class="verdana borderg textcenter txwhite tbsize bovr borderd">
				<div class="lazy newimage">
					<a href="{{ site.url }}" >
					<img src="https://cdn.discordapp.com/attachments/593493405313663042/667510744752848896/AhriBot.png" width="80" height="80">
					</a>
				</div>
				<div class="txtcon">
					<h3 class="tbdsp">
						<span class="txth" onclick="GoPage('https://discordapp.com/oauth2/authorize?client_id=659987132986818560&permissions=519232&scope=bot', tab=true)">Add to Server</span>
						<span class="txth" onclick="GoPage('gallery.html')">Command Gallery</span>
						<span class="txth" onclick="GoPage('https://www.patreon.com/ahribot', tab=true)">Donate</span>
					</h3>
				</div>
			</div>
		</div>


{% seo %}
	



  </head>

  <body class="noscroll">
    <div class="shell">

      <section id="main_content">
        {{ content }}
      </section>

      <footer>
        <p>Generated with <a href="https://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
		<p>Ahri Bot isn’t endorsed by Riot Games and doesn’t reflect the views or opinions of Riot Games or anyone officially involved in producing or managing League of Legends. League of Legends and Riot Games are trademarks or registered trademarks of Riot Games, Inc. League of Legends © Riot Games, Inc.</p>
      </footer>

    </div>

    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
  <div class="stick imgright">
		<a href="https://discordapp.com/invite/2EKRP7H" target="_blank">
		<img src="https://discordapp.com/api/guilds/664978091382276127/widget.png?style=shield">
		</a>
   </div>
</html>
